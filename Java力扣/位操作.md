# Java位操作

## 原码、反码和补码

在Java中，所有数据的表示方法都是以补码的形式表示。

正数的原码、反码和补码一致

负数的原码位对应正数的原码，最高位位符号位，为1。

反码为原码符号位不变，按位取反。补码为反码末位加1。

## [常见整数的计算机表示形式](https://blog.csdn.net/y12345678904/article/details/52854230)

在计算机中，采用二进制补码的储存数据。

Java的int是32位。范围是-2^31^ ~ 2^31^-1。下面以8位为例，给出特殊整数的原码、反码和补码。

| 整数 | 原码      | 反码      | 补码      |
| ---- | --------- | --------- | --------- |
| 1    | 0000-0001 |           |           |
| -1   | 1000-0001 | 1111-1110 | 1111-1111 |
| -127 | 1111-1111 | 1000-0000 | 1000-0001 |
| 0    | 0000-0000 |           |           |
| -128 |           |           | 1000-0000 |

在二进制中，0有正0与负0两种表示方法。**但是，0只需要一个。**因此，-0被人为拿来表示一个最小的数。

-128的补码为1000-0000。这个补码不是真正的补码（人为规定），且没有原码与反码。

## [基本位操作符](https://www.jianshu.com/p/b677858bc085)

| 符号 | 描述               | 位运算规则                                 |
| ---- | :----------------- | :----------------------------------------- |
| &    | 与                 | 两个位都为1时，结果才为1                   |
| \|   | 或                 | 两个位都为0时，结果才为0                   |
| ^    | 异或               | 两个位**相异时为1，相同时为0**             |
| ~    | 取反（单目运算符） | 0 变 1，1 变 0                             |
| <<   | 左移               | 各二进位全部左移若干位，高位丢弃，低位补 0 |
| >>   | 右移               | 各二进位全部右移若干位，**高位补符号位**   |
| >>>  | 无符号右移         | 各二进位全部右移若干位，**高位补0**        |

**注意：**

1. 位操作只能用于**整形（字符）**数据。

2. 位操作的优先级比较低，因此尽量使用**扩号**来确保运算顺序。

3. 另外位操作还有一些复合操作符，如 &=、|=、 ^=、<<=、>>=

## 常用位操作小技巧

下面对位操作的一些常见应用作个总结，有判断奇偶、交换两数、变换符号及求绝对值。这些小技巧应用易记，应当熟练掌握。

### 判断奇偶性

```java
(i & 1) == 0 // 偶数
```

### 交换两数

```java
a ^= b;
b ^= a;
a ^= b;
```

### 变换符号（正变负，负变正）

```java
// 按位取反，末位加1
~a + 1;
```

### 求绝对值

```java
int sign = a >> 31; // 取得符号位,sign值为0或者-1
abs = sign == 0 ? a : ~ a + 1; //方法一
// 方法二：sign为0时，与0异或为a,-0不变；
// sign为-1时，与-1异或相当于按位取反（包括符号位），末位加1
abs = (a ^ sign) - sign；
// 方法二简写为：
abs = (a ^ (a >> 31)) - (a >> 31)
```

### 获取int类型最大最小值

```java
~(1 << 31) // int最大值： 0111-1111
   1 << 31  // int最小值： 1000-0000
```

### 乘以2、除以2运算

```java
a << 1 // 乘以2
a << m // 乘以2的m次方
a >> 1 // 除以2，（负奇数不可用）
a >> m // 除以2的m次方，（负奇数不可用）
```

### 计算n是否为2的幂

```java
n & (n - 1) == 0  // 或
(n & -n) == n
```

## 利用位操作来压缩空间

